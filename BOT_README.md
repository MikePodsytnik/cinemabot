# Cinema Bot

Телеграм-бот для поиска фильмов/сериалов:
- получает метаданные (название, год, рейтинг, описание, постер) через TMDb API
- ищет ссылку "где смотреть" через web-поиск и проверку доступности страницы
- сохраняет историю запросов и статистику по каждому пользователю в SQLite

## Команды

- `/start` — приветствие и краткая справка
- `/help` — помощь по использованию
- `/history` — история последних запросов пользователя (до 10)
- `/stats` — статистика: сколько раз пользователю предлагался каждый фильм (топ-10)

Важно: поиск выполняется по обычному тексту сообщения (без `/find`).

## Источники данных

### Метаданные о фильмах/сериалах
Используется TMDb API:
- поиск: `search/multi`
- детали: отдельный запрос по `movie/tv` для получения расширенной информации (включая постер/описание)

Требуется переменная окружения `TMDB_API_KEY`.

### Ссылка "где смотреть"
Ссылка ищется через web-поиск, затем бот проверяет кандидатов асинхронно:
- доступность (HTTP статус 2xx/3xx)
- что это HTML-страница

Поиск ссылки выполняется по заголовку, который вернул TMDb (чтобы совпадал найденный фильм и ссылка).

## База данных

SQLite хранится в файле, путь задаётся переменной окружения `DB_PATH`.
Пример: `DB_PATH=data/bot.db`.

В БД хранятся:
- история запросов (user_id, timestamp, query, title, url)
- статистика показов (user_id, title, count)

История и статистика ведутся отдельно для каждого пользователя.

## Переменные окружения

Обязательные:
- `BOT_TOKEN` — токен Telegram-бота
- `TMDB_API_KEY` — API key для TMDb

Опциональные:
- `DB_PATH` — путь к SQLite-файлу (по умолчанию `bot.db`)

## Локальный запуск

Установить зависимости:
```bash
pip install -r requirements.txt
